<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Nibi ‚Äì Oracolo Notturno Phygital</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-deep: #050814;
      --bg-card: rgba(5, 9, 28, 0.96);
      --accent-gold: #ffd977;
      --accent-gold-soft: #ffe9b5;
      --accent-blue: #8ea4ff;
      --accent-violet: #9b7dff;
      --text-soft: #c9d0ff;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 40px 16px;
      background:
        radial-gradient(circle at 10% 0%, #263686 0, transparent 48%),
        radial-gradient(circle at 85% 10%, #5a2b85 0, transparent 55%),
        radial-gradient(circle at 50% 120%, #10203f 0, transparent 65%),
        #020308;
      color: #f9f4ff;
    }

    #nibi-oracle-wrapper {
      width: 100%;
      max-width: 720px;
      display: flex;
      justify-content: center;
    }

    .nibi-card {
      position: relative;
      width: 100%;
      background: radial-gradient(circle at 10% 0%, rgba(255, 230, 180, 0.12) 0, transparent 50%),
                  radial-gradient(circle at 100% 120%, rgba(140, 160, 255, 0.16) 0, transparent 60%),
                  var(--bg-card);
      border-radius: 26px;
      padding: 28px 24px 30px;
      border: 1px solid rgba(185, 154, 255, 0.8);
      box-shadow:
        0 0 35px rgba(0, 0, 0, 0.75),
        0 0 55px rgba(152, 118, 255, 0.45),
        0 0 40px rgba(255, 220, 160, 0.25);
      overflow: hidden;
    }

    .nibi-card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 18% 0%, rgba(255, 215, 140, 0.24) 0, transparent 45%),
        radial-gradient(circle at 90% 120%, rgba(118, 176, 255, 0.22) 0, transparent 55%);
      opacity: 0.9;
      pointer-events: none;
      filter: blur(2px);
    }

    .nibi-inner {
      position: relative;
      z-index: 1;
    }

    .nibi-header {
      text-align: center;
      margin-bottom: 18px;
    }

    .nibi-eyebrow {
      font-size: 0.85rem;
      letter-spacing: 0.24em;
      text-transform: uppercase;
      color: var(--accent-gold-soft);
      margin-bottom: 4px;
    }

    .nibi-header h1 {
      font-size: 1.7rem;
      margin: 4px 0 6px;
      color: #fefaf5;
      text-shadow: 0 0 14px rgba(255, 230, 190, 0.55);
    }

    .nibi-header p {
      font-size: 0.95rem;
      color: var(--text-soft);
      max-width: 520px;
      margin: 0 auto;
    }

    .nibi-section-label {
      font-size: 0.85rem;
      color: var(--accent-gold-soft);
      margin-bottom: 6px;
    }

    #nibi-elementi {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    #nibi-elementi button {
      flex: 1 1 45%;
      min-width: 120px;
      border-radius: 999px;
      padding: 7px 10px;
      font-size: 0.86rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      border-width: 1px;
      border-style: solid;
      transition: box-shadow 0.18s ease, opacity 0.18s ease, transform 0.18s ease;
      position: relative;
      overflow: hidden;
    }

    #nibi-elementi button::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 15% 0%, rgba(255, 255, 255, 0.12) 0, transparent 55%);
      opacity: 0;
      transition: opacity 0.18s ease;
      pointer-events: none;
    }

    #nibi-elementi button[data-elemento="fuoco"] {
      border-color: rgba(255, 144, 120, 0.8);
      background: linear-gradient(135deg, #2a1412, #5f201b);
      color: #ffd6c8;
      box-shadow: 0 0 15px rgba(255, 150, 120, 0.5);
    }

    #nibi-elementi button[data-elemento="acqua"] {
      border-color: rgba(164, 214, 255, 0.8);
      background: linear-gradient(135deg, #071a27, #113551);
      color: #d6f0ff;
      opacity: 0.82;
    }

    #nibi-elementi button[data-elemento="aria"] {
      border-color: rgba(174, 246, 176, 0.8);
      background: linear-gradient(135deg, #051b11, #14402a);
      color: #e2ffea;
      opacity: 0.82;
    }

    #nibi-elementi button[data-elemento="terra"] {
      border-color: rgba(240, 206, 140, 0.9);
      background: linear-gradient(135deg, #231509, #4b3113);
      color: #ffe9bd;
      opacity: 0.82;
    }

    #nibi-elementi button[data-elemento="spazio"] {
      border-color: rgba(176, 160, 255, 0.95);
      background: radial-gradient(circle at 15% 0%, #1e1b5a 0, #090b2d 50%, #09071b 100%);
      color: #e2ddff;
      flex: 1 1 100%;
      opacity: 0.82;
    }

    #nibi-elementi button.nibi-elemento-attivo {
      transform: translateY(-1px);
      box-shadow:
        0 0 14px rgba(255, 233, 186, 0.9),
        0 0 30px rgba(145, 124, 255, 0.65);
    }

    #nibi-elementi button.nibi-elemento-attivo::after {
      opacity: 1;
    }

    #nibi-selezionato-label {
      margin-top: 8px;
      font-size: 0.85rem;
      color: #cfd4ff;
    }

    .nibi-center {
      text-align: center;
    }

    #nibi-oracle-button {
      border: none;
      border-radius: 999px;
      padding: 11px 28px;
      cursor: pointer;
      font-size: 0.95rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      font-weight: 600;
      color: #1a1230;
      background: radial-gradient(circle at 20% 0%, #fff6cf 0, #ffd773 32%, #f3b64f 68%, #b98035 100%);
      box-shadow:
        0 0 22px rgba(255, 220, 153, 0.95),
        0 0 40px rgba(150, 128, 255, 0.85);
      position: relative;
      overflow: hidden;
    }

    #nibi-oracle-button::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at 0% 0%, rgba(255, 255, 255, 0.45) 0, transparent 55%);
      opacity: 0;
      transform: translateX(-40%);
      transition: opacity 0.35s ease, transform 0.35s ease;
    }

    #nibi-oracle-button:hover::before {
      opacity: 1;
      transform: translateX(30%);
    }

    #nibi-status {
      margin-top: 6px;
      font-size: 0.8rem;
      color: var(--accent-blue);
    }

    #nibi-output {
      margin-top: 10px;
      padding: 14px 14px 16px;
      border-radius: 18px;
      background: radial-gradient(circle at 0% 0%, rgba(255, 233, 186, 0.06) 0, transparent 55%),
                  radial-gradient(circle at 100% 100%, rgba(154, 132, 255, 0.1) 0, transparent 60%),
                  linear-gradient(145deg, rgba(11, 16, 40, 0.96), rgba(4, 8, 22, 0.98));
      border: 1px solid rgba(121, 103, 255, 0.8);
      box-shadow: 0 0 18px rgba(0, 0, 0, 0.6) inset;
      font-size: 0.9rem;
    }

    #nibi-output-title {
      color: var(--accent-gold-soft);
      margin-bottom: 4px;
    }

    #nibi-output p {
      margin: 0 0 8px;
      color: var(--text-soft);
    }

    #nibi-output ul {
      list-style: none;
      padding: 0;
      margin: 0;
      font-size: 0.88rem;
      color: #c9d0ff;
    }

    #nibi-output ul li {
      margin: 1px 0;
    }

    #nibi-out-messaggio {
      margin-top: 4px;
      color: #e9f0ff;
    }

    .nibi-footer {
      margin-top: 10px;
      text-align: right;
      font-size: 0.75rem;
      color: #a09ad9;
    }

    @media (max-width: 520px) {
      body {
        padding: 26px 10px;
      }
      .nibi-card {
        padding: 22px 16px 24px;
      }
      #nibi-elementi button {
        flex: 1 1 100%;
      }
    }
  </style>
</head>
<body>

<div id="nibi-oracle-wrapper">
  <div class="nibi-card">
    <div class="nibi-inner">
      <div class="nibi-header">
        <div class="nibi-eyebrow">
          NIBI ‚Äì ORACOLO NOTTURNO PHYGITAL
        </div>
        <h1>Scegli il tuo Nibi e ricevi il Messaggio del Giorno</h1>
        <p>
          Avvicina il tuo telefono alla scultura Nibi o seleziona qui il tuo elemento.
          Clicca su <strong>‚ÄúDammi il Messaggio del Giorno‚Äù</strong> per ricevere un responso intuitivo
          con runa, senso, mantra e segni collegati. Se il tuo telefono lo supporta, Nibi ti parler√† anche a voce.
        </p>
      </div>

      <div>
        <div class="nibi-section-label">
          1. Seleziona il Nibi che possiedi:
        </div>

        <div id="nibi-elementi">
          <button type="button" data-elemento="fuoco" onclick="selezionaNibi(this)">
            üî• Nibi Rosso ‚Äì Fuoco
          </button>
          <button type="button" data-elemento="acqua" onclick="selezionaNibi(this)">
            üíß Nibi Bianco ‚Äì Acqua
          </button>
          <button type="button" data-elemento="aria" onclick="selezionaNibi(this)">
            üåø Nibi Verde ‚Äì Aria
          </button>
          <button type="button" data-elemento="terra" onclick="selezionaNibi(this)">
            üåï Nibi Giallo ‚Äì Terra
          </button>
          <button type="button" data-elemento="spazio" onclick="selezionaNibi(this)">
            üåå Nibi Blu ‚Äì Spazio
          </button>
        </div>

        <div id="nibi-selezionato-label">
          Nibi selezionato: <strong>Rosso ‚Äì Fuoco</strong>
        </div>
      </div>

      <div class="nibi-center" style="margin:10px 0 16px;">
        <div class="nibi-section-label">
          2. Ricevi il responso di Nibi:
        </div>
        <button id="nibi-oracle-button" onclick="chiediMessaggioNibi()">
          ‚ú® Dammi il Messaggio del Giorno
        </button>
        <div id="nibi-status">
          In ascolto... Nibi raccoglie i frammenti di energia del momento.
        </div>
      </div>

      <div id="nibi-output">
        <div id="nibi-output-title">
          Messaggio intuitivo di Nibi
        </div>
        <p>
          Quando chiedi, Nibi risponde. Dopo aver toccato la scultura o selezionato il tuo elemento,
          clicca sul pulsante per ricevere un responso unico per questo momento.
        </p>
        <ul>
          <li><strong>Elemento:</strong> <span id="nibi-out-elemento">Fuoco</span></li>
          <li><strong>Runa:</strong> <span id="nibi-out-runa">‚Äî</span></li>
          <li><strong>Senso:</strong> <span id="nibi-out-senso">‚Äî</span></li>
          <li><strong>Mantra:</strong> <span id="nibi-out-mantra">‚Äî</span></li>
          <li><strong>Segni zodiacali:</strong> <span id="nibi-out-segni">‚Äî</span></li>
        </ul>
        <div style="margin-top:8px;">
          <strong>Messaggio del giorno:</strong>
          <div id="nibi-out-messaggio">
            Inizia respirando profondamente. Lascia che il tuo Nibi ti trovi, invece di cercare tu la risposta.
          </div>
        </div>
      </div>

      <div class="nibi-footer">
        Oracolo NIBI ‚Äì progetto phygital di Tina √ñrn üúÅ üúÇ üúÉ üúÑ üúÄ
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // URL del backend Cloud Run (JSON)
  const CLOUD_RUN_URL = "https://oracolo-nibi-web-207246221438.europe-west1.run.app";
  let elementoCorrente = "fuoco";

  function resetGlowButtons() {
    const buttons = document.querySelectorAll("#nibi-elementi button[data-elemento]");
    buttons.forEach(b => {
      b.classList.remove("nibi-elemento-attivo");
      if (b.dataset.elemento !== "fuoco") {
        b.style.opacity = "0.82";
      }
    });
  }

  window.selezionaNibi = function(btn) {
    resetGlowButtons();
    elementoCorrente = btn.dataset.elemento || "fuoco";
    btn.classList.add("nibi-elemento-attivo");
    btn.style.opacity = "1";

    const label = document.getElementById("nibi-selezionato-label");
    if (label) {
      label.innerHTML = "Nibi selezionato: <strong>" + btn.innerText.trim() + "</strong>";
    }

    const outElem = document.getElementById("nibi-out-elemento");
    if (outElem) {
      const nameParts = (btn.innerText || "").split("‚Äì");
      const shortName = (nameParts[0] || "").trim().replace(/^[^\s]+\s/, "") || elementoCorrente;
      outElem.textContent = shortName;
    }
  };

  // Fallback locale se Cloud Run non risponde
  function generaFallback(elemento) {
    const base = (elemento || "fuoco").toLowerCase();
    const map = {
      fuoco: {
        runa: "·õÉ Jera",
        senso: "Vista interiore",
        mantra: "Lascio che il fuoco trasformi ci√≤ che non mi serve pi√π.",
        segni: "Ariete, Leone, Sagittario",
        msg: "Il tuo fuoco oggi chiede spazio. Non soffocarlo con i dubbi: scegli un‚Äôazione piccola ma coraggiosa e onora la tua fiamma."
      },
      acqua: {
        runa: "·ö¢ Uruz",
        senso: "Tattilit√† / Pelle",
        mantra: "Mi lascio attraversare dalle emozioni senza affogare in esse.",
        segni: "Cancro, Scorpione, Pesci",
        msg: "Qualcosa si sta sciogliendo dentro di te. Non trattenere le lacrime, i sospiri, i sospesi: lascia che l‚Äôacqua porti via la stanchezza."
      },
      aria: {
        runa: "·õâ Algiz",
        senso: "Respiro",
        mantra: "Ogni respiro crea spazio per una nuova possibilit√†.",
        segni: "Gemelli, Bilancia, Acquario",
        msg: "La mente corre, ma oggi hai il permesso di rallentare. Un respiro profondo pu√≤ cambiare la forma dei pensieri."
      },
      terra: {
        runa: "·õÉ Jera",
        senso: "Olfatto / Radici",
        mantra: "Sono radicata nel presente, anche quando tutto cambia.",
        segni: "Toro, Vergine, Capricorno",
        msg: "Le tue radici stanno cercando un terreno pi√π fertile. Nutriti con gesti semplici, concreti, gentili verso il tuo corpo."
      },
      spazio: {
        runa: "·õà Perthro",
        senso: "Sesto senso",
        mantra: "Mi fido dei segni sottili che l‚ÄôUniverso mi manda.",
        segni: "Tutti i segni",
        msg: "Una coincidenza ti sta parlando. Oggi nota il dettaglio che si ripete: numero, parola, simbolo. √à un messaggio per te."
      }
    };
    const d = map[base] || map.fuoco;
    return {
      elemento: base.charAt(0).toUpperCase() + base.slice(1),
      runa: d.runa,
      senso: d.senso,
      mantra: d.mantra,
      segni_zodiacali: d.segni,
      messaggio: d.msg
    };
  }

  // Funzione per far parlare Nibi usando la voce del telefono
  function parlaTesto(testo) {
    if (!("speechSynthesis" in window)) {
      return;
    }
    try {
      window.speechSynthesis.cancel();
      const utter = new SpeechSynthesisUtterance(testo);
      utter.lang = "it-IT";
      utter.rate = 1;
      utter.pitch = 1;
      window.speechSynthesis.speak(utter);
    } catch (e) {
      console.warn("Problema con la sintesi vocale:", e);
    }
  }

  window.chiediMessaggioNibi = async function() {
    const statusEl = document.getElementById("nibi-status");
    const btn = document.getElementById("nibi-oracle-button");
    if (statusEl) {
      statusEl.textContent = "Nibi sta raccogliendo frammenti di futuro... ‚ú®";
      statusEl.style.color = "#ffe9ba";
    }
    if (btn) {
      btn.disabled = true;
      btn.style.opacity = "0.7";
      btn.style.cursor = "wait";
    }

    let data = null;

    try {
      const resp = await fetch(CLOUD_RUN_URL + "?elemento=" + encodeURIComponent(elementoCorrente));
      if (resp.ok) {
        data = await resp.json();
      }
    } catch (err) {
      console.warn("Impossibile contattare Cloud Run, uso fallback locale.", err);
    }

    // Se Cloud Run non risponde, usiamo un messaggio locale
    if (!data) {
      data = generaFallback(elementoCorrente);
      if (statusEl) {
        statusEl.textContent = "Oggi Nibi ti parla da dentro la scultura, senza rete. ‚ú®";
        statusEl.style.color = "#c9d0ff";
      }
    } else {
      if (statusEl) {
        statusEl.textContent = "Messaggio ricevuto. Se vuoi, ascolta la voce di Nibi o torna domani per un nuovo responso.";
        statusEl.style.color = "#c9d0ff";
      }
    }

    const elemento = data.elemento || elementoCorrente;
    const runa = data.runa || data.runa_principale || "‚Äî";
    const senso = data.senso || "‚Äî";
    const mantra = data.mantra || "‚Äî";
    const segni = Array.isArray(data.segni_zodiacali)
      ? data.segni_zodiacali.join(", ")
      : (data.segni_zodiacali || "‚Äî");
    const messaggio = data.messaggio || data.testo || "Il silenzio contiene gi√† la risposta. Ascolta cosa vibra nel tuo corpo dopo questa domanda.";

    const outElem = document.getElementById("nibi-out-elemento");
    const outRuna = document.getElementById("nibi-out-runa");
    const outSenso = document.getElementById("nibi-out-senso");
    const outMantra = document.getElementById("nibi-out-mantra");
    const outSegni = document.getElementById("nibi-out-segni");
    const outMsg = document.getElementById("nibi-out-messaggio");

    if (outElem) outElem.textContent = elemento.charAt(0).toUpperCase() + elemento.slice(1);
    if (outRuna) outRuna.textContent = runa;
    if (outSenso) outSenso.textContent = senso;
    if (outMantra) outMantra.textContent = mantra;
    if (outSegni) outSegni.textContent = segni;
    if (outMsg) outMsg.textContent = messaggio;

    const testoVocale =
      "Elemento: " + elemento + ". " +
      (runa !== "‚Äî" ? "Runa: " + runa + ". " : "") +
      (senso !== "‚Äî" ? "Senso: " + senso + ". " : "") +
      (mantra !== "‚Äî" ? "Mantra: " + mantra + ". " : "") +
      "Messaggio del giorno: " + messaggio;

    parlaTesto(testoVocale);

    if (btn) {
      btn.disabled = false;
      btn.style.opacity = "1";
      btn.style.cursor = "pointer";
    }
  };

  document.addEventListener("DOMContentLoaded", () => {
    const first = document.querySelector("#nibi-elementi button[data-elemento='fuoco']");
    if (first) window.selezionaNibi(first);
  });
})();
</script>

</body>
</html>
